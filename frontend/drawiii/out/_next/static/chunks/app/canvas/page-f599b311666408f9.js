(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[423],{5363:(e,t,n)=>{"use strict";let o;n.r(t),n.d(t,{default:()=>w});var r=n(5155),i=n(7458),c=n(2115);let l=null;function s(e){return new Promise(t=>setTimeout(t,e))}async function u(e){l&&l.connected||function(){if(l&&l.connected)return console.log("already connected to server");l=(0,i.io)(window.location.origin),console.log("connected to server"),l.on("user_joined",()=>{console.log("User connected to room")})}(),void 0===e&&await m(),l.emit("join_room",{room:e})}function a(){console.log(o),u(o);let e=(0,c.useRef)(null),t=(0,c.useRef)(!1);return(0,c.useEffect)(()=>{let n=e.current;if(!n)return;let r=n.getContext("2d");n.width=1920,n.height=1080,r.fillStyle="black",r.fillRect(0,0,n.width,n.height);let i=()=>{let e=1920/1080,t=window.innerWidth,o=window.innerHeight;t/o>e?t=o*e:o=t/e,n.style.width="".concat(t,"px"),n.style.height="".concat(o,"px")},c=e=>{let t=n.getBoundingClientRect(),o=n.width/t.width,r=n.height/t.height;return{x:(e.clientX-t.left)*o,y:(e.clientY-t.top)*r}},a=e=>{null===o&&(m(),u(o)),console.log("Startdraw"),t.current=!0;let n=c(e);r.beginPath(),r.moveTo(n.x,n.y),l.emit("draw_stroke",{room:o,from:null,to:[n.x,n.y]}),r.currentX=n.x,r.currentY=n.y},d=e=>{if(!t.current)return;let n=c(e);r.lineTo(n.x,n.y),r.strokeStyle="white",r.lineWidth=2,r.stroke(),l.emit("draw_stroke",{room:o,from:[r.currentX,r.currentY],to:[n.x,n.y]}),r.currentX=n.x,r.currentY=n.y},w=e=>{t.current&&(t.current=!1)},v=e=>{let{from:t,to:n}=e;console.log("from: ".concat(t,",,, to: ").concat(n)),r.strokeStyle="white",r.lineWidth=2,r.beginPath(),t?r.moveTo(t[0],t[1]):r.moveTo(n[0],n[1]),r.lineTo(n[0],n[1]),r.stroke(),r.closePath()};return window.addEventListener("resize",i),i(),n.addEventListener("mousedown",a),n.addEventListener("mousemove",d),n.addEventListener("mouseup",w),n.addEventListener("mouseleave",w),async function(){null===l&&(console.log("socket null"),await s(2e3)),l.connected?l.on("receive_stroke",v):l.once("connect",()=>{l.on("receive_stroke",v)})}(),()=>{window.removeEventListener("resize",i),n.removeEventListener("mousedown",a),n.removeEventListener("mousemove",d),n.removeEventListener("mouseup",w),n.removeEventListener("mouseleave",w),l.off("receive_stroke",v)}},[t]),(0,r.jsx)("canvas",{ref:e,style:{display:"block",position:"fixed",top:0,left:0}})}async function d(e){let t=new URLSearchParams(window.location.search);return console.log("para"+t),t.get(e)||(await s(500),d("room")),t.get(e)}async function m(){o=await d("room")}function w(){return m(),u(o),(0,r.jsx)(a,{})}},8529:(e,t,n)=>{Promise.resolve().then(n.bind(n,5363))}},e=>{e.O(0,[458,441,964,358],()=>e(e.s=8529)),_N_E=e.O()}]);