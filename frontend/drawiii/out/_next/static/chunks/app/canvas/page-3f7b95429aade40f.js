(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[423],{5363:(e,t,o)=>{"use strict";let n;o.r(t),o.d(t,{default:()=>u});var r=o(5155),i=o(7458);o(5695);var l=o(2115);let s=null;function c(){let e=(0,l.useRef)(null),t=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{let o=e.current;if(!o)return;let r=o.getContext("2d");o.width=1920,o.height=1080,r.fillStyle="black",r.fillRect(0,0,o.width,o.height);let i=()=>{let e=1920/1080,t=window.innerWidth,n=window.innerHeight;t/n>e?t=n*e:n=t/e,o.style.width="".concat(t,"px"),o.style.height="".concat(n,"px")},l=e=>{let t=o.getBoundingClientRect(),n=o.width/t.width,r=o.height/t.height;return{x:(e.clientX-t.left)*n,y:(e.clientY-t.top)*r}},c=e=>{console.log("Startdraw"),t.current=!0;let o=l(e);r.beginPath(),r.moveTo(o.x,o.y),s.emit("draw_stroke",{room:n,from:null,to:[o.x,o.y]}),r.currentX=o.x,r.currentY=o.y},u=e=>{if(!t.current)return;let o=l(e);r.lineTo(o.x,o.y),r.strokeStyle="white",r.lineWidth=2,r.stroke(),s.emit("draw_stroke",{room:n,from:[r.currentX,r.currentY],to:[o.x,o.y]}),r.currentX=o.x,r.currentY=o.y},d=e=>{t.current&&(t.current=!1)},a=e=>{let{from:t,to:o}=e;console.log("from: ".concat(t,",,, to: ").concat(o)),r.strokeStyle="white",r.lineWidth=2,r.beginPath(),t?r.moveTo(t[0],t[1]):r.moveTo(o[0],o[1]),r.lineTo(o[0],o[1]),r.stroke(),r.closePath()};return window.addEventListener("resize",i),i(),o.addEventListener("mousedown",c),o.addEventListener("mousemove",u),o.addEventListener("mouseup",d),o.addEventListener("mouseleave",d),async function(){null===s&&(console.log("socket null"),await new Promise(e=>setTimeout(e,2e3))),s.connected?s.on("receive_stroke",a):s.once("connect",()=>{s.on("receive_stroke",a)})}(),()=>{window.removeEventListener("resize",i),o.removeEventListener("mousedown",c),o.removeEventListener("mousemove",u),o.removeEventListener("mouseup",d),o.removeEventListener("mouseleave",d),s.off("receive_stroke",a)}},[t]),(0,r.jsx)("canvas",{ref:e,style:{display:"block",position:"fixed",top:0,left:0}})}function u(){let e=new URLSearchParams(window.location.search).get("room");return n=e,(0,l.useEffect)(()=>{e&&(s&&s.connected||function(){if(s&&s.connected)return console.log("already connected to server");s=(0,i.io)("http://localhost:5000"),console.log("connected to server"),s.on("user_joined",()=>{console.log("User connected to room")})}(),s.emit("join_room",{room:e}))},[e]),(0,r.jsx)(c,{})}},8529:(e,t,o)=>{Promise.resolve().then(o.bind(o,5363))}},e=>{e.O(0,[52,441,964,358],()=>e(e.s=8529)),_N_E=e.O()}]);